ParamFracI$Estrategia[(NFrac+1):(NFrac*2)] <- paste0("R", (1:NFrac)) # Asignación de nombres de estrategias de referencia
ParamFracI$`Periodo inicio`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo inicio`[1:NFrac] # Réplica de periodo inicio de estrategia
ParamFracI$`Periodo fin`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo fin`[1:NFrac] # Réplica de periodo fin de estrategia
# Variables de codificación de fractales
ParamFracI$VentanaMovil <- ParamFracI$`Periodo fin` - ParamFracI$`Periodo inicio` + 1
ParamFracI$Desfase <- -ParamFracI$`Periodo fin`
ParamFracI$Fractal <- paste0("FI", ParamFracI$Estrategia)
ParamFracI$NombreRefCompra <- paste0(ParamFracI$Fractal,
"_B_",
ParamFracI$`Función compra`,
ParamFracI$`Ref. compra`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$NombreRefVenta <- paste0(ParamFracI$Fractal,
"_S_",
ParamFracI$`Función venta`,
ParamFracI$`Ref. venta`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$VariableCompra <- paste0("BDPI$",ParamFracI$`Variable compra`)
ParamFracI$RefCompra <- paste0("BDPI$",ParamFracI$`Ref. compra`)
ParamFracI$VariableVenta <- paste0("BDPI$",ParamFracI$`Variable venta`)
ParamFracI$RefVenta <- paste0("BDPI$",ParamFracI$`Ref. venta`)
# Separación entre parámetros para FIR y para FI
ParamFracR <- ParamFracI[match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracI <- ParamFracI[-match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracR$Fractal <- ParamFracR$Estrategia # Réplica de nombres para FIR
# eval(parse(text = y))
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- rollapplyr(data = ", ParamFracI$RefCompra,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función compra`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- shift(x = BDPI$MAX_HIGH_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefCompra,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- rollapplyr(data = BDPI$LOW, width = 4, FUN = min, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- rollapplyr(data = ", ParamFracI$RefVenta,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función venta`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- shift(x = BDPI$MIN_LOW_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefVenta,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Señal del fractal.
# Ejemplo FI1:
# BDPI$FI1 <- ifelse (BDPI$CLOSE > BDPI$FI1_B_MAX_HIGH_4_1, "BUY", ifelse(BDPI$CLOSE < BDPI$FI1_S_MIN_LOW_4_1, "SELL", NA))
eval(parse(text = paste0("BDPI$", ParamFracI$Fractal,
" <- ifelse(",
ParamFracI$VariableCompra, ParamFracI$`Criterio compra`, "BDPI$", ParamFracI$NombreRefCompra,
", 'BUY', ",
"ifelse(",
ParamFracI$VariableVenta, ParamFracI$`Criterio venta`, "BDPI$", ParamFracI$NombreRefVenta,
", 'SELL', ",
"NA",
")",
")"
)
)
)
# Ubicación archivos de origen
BaseDirPath = dirname(getActiveDocumentContext()$path)
setwd(BaseDirPath)
# 2. LECTURA Y PREPARACIÓN DE DATOS ###########################################
# Lectura de archivo histórico de precios
ArchivoCargue <- "Data ETF ECH.xlsx"
BDPI <- read_excel(ArchivoCargue, sheet = "DATOS ECH")
# Asignación de títulos a las columnas
colnames(BDPI) <- c("DATE","FRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")
# Reorganizacion de fechas y franjas horarias
BDPI$DATEFRAME <- make_datetime(year = year(BDPI$DATE),
month = month(BDPI$DATE),
day = day(BDPI$DATE),
hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# 3. CÁLCULO SEÑALES ##########################################################
# Insumos parametrización FI y FD
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFracI <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
# Insumos parametrización FIR
NFrac <- length(ParamFracI$Estrategia) - 1 # Número de fractales
ParamFracI[(NFrac+2):(NFrac*2),] <- ParamFracI[(NFrac+1),] # Réplica de parámetros de FIR
ParamFracI$Estrategia[(NFrac+1):(NFrac*2)] <- paste0("R", (1:NFrac)) # Asignación de nombres de estrategias de referencia
ParamFracI$`Periodo inicio`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo inicio`[1:NFrac] # Réplica de periodo inicio de estrategia
ParamFracI$`Periodo fin`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo fin`[1:NFrac] # Réplica de periodo fin de estrategia
# Variables de codificación de fractales
ParamFracI$VentanaMovil <- ParamFracI$`Periodo fin` - ParamFracI$`Periodo inicio` + 1
ParamFracI$Desfase <- -ParamFracI$`Periodo fin`
ParamFracI$Fractal <- paste0("FI", ParamFracI$Estrategia)
ParamFracI$NombreRefCompra <- paste0(ParamFracI$Fractal,
"_B_",
ParamFracI$`Función compra`,
ParamFracI$`Ref. compra`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$NombreRefVenta <- paste0(ParamFracI$Fractal,
"_S_",
ParamFracI$`Función venta`,
ParamFracI$`Ref. venta`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$VariableCompra <- paste0("BDPI$",ParamFracI$`Variable compra`)
ParamFracI$RefCompra <- paste0("BDPI$",ParamFracI$`Ref. compra`)
ParamFracI$VariableVenta <- paste0("BDPI$",ParamFracI$`Variable venta`)
ParamFracI$RefVenta <- paste0("BDPI$",ParamFracI$`Ref. venta`)
# Separación entre parámetros para FIR y para FI
ParamFracR <- ParamFracI[match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracI <- ParamFracI[-match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracR$Fractal <- ParamFracR$Estrategia # Réplica de nombres para FIR
# eval(parse(text = y))
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- rollapplyr(data = ", ParamFracI$RefCompra,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función compra`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- shift(x = BDPI$MAX_HIGH_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefCompra,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- rollapplyr(data = BDPI$LOW, width = 4, FUN = min, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- rollapplyr(data = ", ParamFracI$RefVenta,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función venta`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- shift(x = BDPI$MIN_LOW_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefVenta,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Señal del fractal.
# Ejemplo FI1:
# BDPI$FI1 <- ifelse (BDPI$CLOSE > BDPI$FI1_B_MAX_HIGH_4_1, "BUY", ifelse(BDPI$CLOSE < BDPI$FI1_S_MIN_LOW_4_1, "SELL", NA))
eval(parse(text = paste0("BDPI$", ParamFracI$Fractal,
" <- ifelse(",
ParamFracI$VariableCompra, ParamFracI$`Criterio compra`, "BDPI$", ParamFracI$NombreRefCompra,
", 'BUY', ",
"ifelse(",
ParamFracI$VariableVenta, ParamFracI$`Criterio venta`, "BDPI$", ParamFracI$NombreRefVenta,
", 'SELL', ",
"NA",
")",
")"
)
)
)
# Ubicación archivos de origen
BaseDirPath = dirname(getActiveDocumentContext()$path)
setwd(BaseDirPath)
#Plantilla gráficos
# 2. LECTURA Y PREPARACIÓN DE DATOS ###########################################
# Lectura de archivo histórico de precios
ArchivoCargue <- "Data ETF ECH.xlsx"
BDPI <- read_excel(ArchivoCargue, sheet = "DATOS ECH")
# Asignación de títulos a las columnas
colnames(BDPI) <- c("DATE","FRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")
# Reorganizacion de fechas y franjas horarias
BDPI$DATEFRAME <- make_datetime(year = year(BDPI$DATE),
month = month(BDPI$DATE),
day = day(BDPI$DATE),
hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# 3. CÁLCULO SEÑALES ##########################################################
# Insumos parametrización FI y FD
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFracI <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
# Insumos parametrización FIR
NFrac <- length(ParamFracI$Estrategia) - 1 # Número de fractales
ParamFracI[(NFrac+2):(NFrac*2),] <- ParamFracI[(NFrac+1),] # Réplica de parámetros de FIR
ParamFracI$Estrategia[(NFrac+1):(NFrac*2)] <- paste0("R", (1:NFrac)) # Asignación de nombres de estrategias de referencia
ParamFracI$`Periodo inicio`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo inicio`[1:NFrac] # Réplica de periodo inicio de estrategia
ParamFracI$`Periodo fin`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo fin`[1:NFrac] # Réplica de periodo fin de estrategia
# Variables de codificación de fractales
ParamFracI$VentanaMovil <- ParamFracI$`Periodo fin` - ParamFracI$`Periodo inicio` + 1
ParamFracI$Desfase <- -ParamFracI$`Periodo fin`
ParamFracI$Fractal <- paste0("FI", ParamFracI$Estrategia)
ParamFracI$NombreRefCompra <- paste0(ParamFracI$Fractal,
"_B_",
ParamFracI$`Función compra`,
ParamFracI$`Ref. compra`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$NombreRefVenta <- paste0(ParamFracI$Fractal,
"_S_",
ParamFracI$`Función venta`,
ParamFracI$`Ref. venta`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$VariableCompra <- paste0("BDPI$",ParamFracI$`Variable compra`)
ParamFracI$RefCompra <- paste0("BDPI$",ParamFracI$`Ref. compra`)
ParamFracI$VariableVenta <- paste0("BDPI$",ParamFracI$`Variable venta`)
ParamFracI$RefVenta <- paste0("BDPI$",ParamFracI$`Ref. venta`)
# Separación entre parámetros para FIR y para FI
ParamFracR <- ParamFracI[match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracI <- ParamFracI[-match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracR$Fractal <- ParamFracR$Estrategia # Réplica de nombres para FIR
# eval(parse(text = y))
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- rollapplyr(data = ", ParamFracI$RefCompra,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función compra`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- shift(x = BDPI$MAX_HIGH_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefCompra,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- rollapplyr(data = BDPI$LOW, width = 4, FUN = min, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- rollapplyr(data = ", ParamFracI$RefVenta,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función venta`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- shift(x = BDPI$MIN_LOW_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefVenta,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Señal del fractal.
# Ejemplo FI1:
# BDPI$FI1 <- ifelse (BDPI$CLOSE > BDPI$FI1_B_MAX_HIGH_4_1, "BUY", ifelse(BDPI$CLOSE < BDPI$FI1_S_MIN_LOW_4_1, "SELL", NA))
eval(parse(text = paste0("BDPI$", ParamFracI$Fractal,
" <- ifelse(",
ParamFracI$VariableCompra, ParamFracI$`Criterio compra`, "BDPI$", ParamFracI$NombreRefCompra,
", 'BUY', ",
"ifelse(",
ParamFracI$VariableVenta, ParamFracI$`Criterio venta`, "BDPI$", ParamFracI$NombreRefVenta,
", 'SELL', ",
"NA",
")",
")"
)
)
)
View(ParamFracI)
# Ubicación archivos de origen
BaseDirPath = dirname(getActiveDocumentContext()$path)
setwd(BaseDirPath)
# Lectura de archivo histórico de precios
ArchivoCargue <- "Data ETF ECH.xlsx"
BDPI <- read_excel(ArchivoCargue, sheet = "DATOS ECH")
# Asignación de títulos a las columnas
colnames(BDPI) <- c("DATE","FRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")
# Reorganizacion de fechas y franjas horarias
BDPI$DATEFRAME <- make_datetime(year = year(BDPI$DATE),
month = month(BDPI$DATE),
day = day(BDPI$DATE),
hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# Insumos parametrización FI y FD
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFracI <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
View(ParamFracI)
# Insumos parametrización FIR
NFrac <- length(ParamFracI$Estrategia) - 1 # Número de fractales
ParamFracI[(NFrac+2):(NFrac*2),] <- ParamFracI[(NFrac+1),] # Réplica de parámetros de FIR
ParamFracI$Estrategia[(NFrac+1):(NFrac*2)] <- paste0("R", (1:NFrac)) # Asignación de nombres de estrategias de referencia
ParamFracI$`Periodo inicio`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo inicio`[1:NFrac] # Réplica de periodo inicio de estrategia
ParamFracI$`Periodo fin`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo fin`[1:NFrac] # Réplica de periodo fin de estrategia
# Variables de codificación de fractales
ParamFracI$VentanaMovil <- ParamFracI$`Periodo fin` - ParamFracI$`Periodo inicio` + 1
ParamFracI$Desfase <- -ParamFracI$`Periodo fin`
ParamFracI$Fractal <- paste0("FI", ParamFracI$Estrategia)
ParamFracI$NombreRefCompra <- paste0(ParamFracI$Fractal,
"_B_",
ParamFracI$`Función compra`,
ParamFracI$`Ref. compra`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$NombreRefVenta <- paste0(ParamFracI$Fractal,
"_S_",
ParamFracI$`Función venta`,
ParamFracI$`Ref. venta`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$VariableCompra <- paste0("BDPI$",ParamFracI$`Variable compra`)
ParamFracI$RefCompra <- paste0("BDPI$",ParamFracI$`Ref. compra`)
ParamFracI$VariableVenta <- paste0("BDPI$",ParamFracI$`Variable venta`)
ParamFracI$RefVenta <- paste0("BDPI$",ParamFracI$`Ref. venta`)
# Separación entre parámetros para FIR y para FI
ParamFracR <- ParamFracI[match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracI <- ParamFracI[-match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracR$Fractal <- ParamFracR$Estrategia # Réplica de nombres para FIR
# eval(parse(text = y))
View(ParamFracI)
n archivos de origen
BaseDirPath = dirname(getActiveDocumentContext()$path)
setwd(BaseDirPath)
#Plantilla gráficos
# 2. LECTURA Y PREPARACIÓN DE DATOS ###########################################
# Lectura de archivo histórico de precios
ArchivoCargue <- "Data ETF ECH.xlsx"
BDPI <- read_excel(ArchivoCargue, sheet = "DATOS ECH")
# Asignación de títulos a las columnas
colnames(BDPI) <- c("DATE","FRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")
# Reorganizacion de fechas y franjas horarias
BDPI$DATEFRAME <- make_datetime(year = year(BDPI$DATE),
month = month(BDPI$DATE),
day = day(BDPI$DATE),
hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# 3. CÁLCULO SEÑALES ##########################################################
# Insumos parametrización FI y FD
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFracI <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
# Insumos parametrización FIR
NFrac <- length(ParamFracI$Estrategia) - 1 # Número de fractales
ParamFracI[(NFrac+2):(NFrac*2),] <- ParamFracI[(NFrac+1),] # Réplica de parámetros de FIR
ParamFracI$Estrategia[(NFrac+1):(NFrac*2)] <- paste0("R", (1:NFrac)) # Asignación de nombres de estrategias de referencia
ParamFracI$`Periodo inicio`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo inicio`[1:NFrac] # Réplica de periodo inicio de estrategia
ParamFracI$`Periodo fin`[(NFrac+1):(NFrac*2)] <- ParamFracI$`Periodo fin`[1:NFrac] # Réplica de periodo fin de estrategia
View(ParamFracI)
# Variables de codificación de fractales
ParamFracI$VentanaMovil <- ParamFracI$`Periodo fin` - ParamFracI$`Periodo inicio` + 1
ParamFracI$Desfase <- -ParamFracI$`Periodo fin`
ParamFracI$Fractal <- paste0("FI", ParamFracI$Estrategia)
ParamFracI$NombreRefCompra <- paste0(ParamFracI$Fractal,
"_B_",
ParamFracI$`Función compra`,
ParamFracI$`Ref. compra`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$NombreRefVenta <- paste0(ParamFracI$Fractal,
"_S_",
ParamFracI$`Función venta`,
ParamFracI$`Ref. venta`,
"_",
-ParamFracI$`Periodo inicio`,
"_",
-ParamFracI$`Periodo fin`
)
ParamFracI$VariableCompra <- paste0("BDPI$",ParamFracI$`Variable compra`)
ParamFracI$RefCompra <- paste0("BDPI$",ParamFracI$`Ref. compra`)
ParamFracI$VariableVenta <- paste0("BDPI$",ParamFracI$`Variable venta`)
ParamFracI$RefVenta <- paste0("BDPI$",ParamFracI$`Ref. venta`)
View(ParamFracI)
# Separación entre parámetros para FIR y para FI
ParamFracR <- ParamFracI[match(paste0("FIR",(1:NFrac)),ParamFracI$Estrategia),]
View(ParamFracI)
View(ParamFracR)
View(ParamFracI)
# Separación entre parámetros para FIR y para FI
ParamFracR <- ParamFracI[match(paste0("R",(1:NFrac)),ParamFracI$Estrategia),]
View(ParamFracR)
ParamFracI <- ParamFracI[-match(paste0("R",(1:NFrac)),ParamFracI$Estrategia),]
ParamFracR$Fractal <- ParamFracR$Estrategia # Réplica de nombres para FIR
View(ParamFracI)
View(ParamFracR)
View(ParamFracR)
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- rollapplyr(data = ", ParamFracI$RefCompra,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función compra`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de compra.
# Ejemplo FI1:
# BDPI$FI1_B_MAX_HIGH_4_1 <- shift(x = BDPI$MAX_HIGH_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefCompra,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefCompra,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Cálculo de la funcion sobre la referencia correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- rollapplyr(data = BDPI$LOW, width = 4, FUN = min, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- rollapplyr(data = ", ParamFracI$RefVenta,
", width = ", ParamFracI$VentanaMovil,
", FUN = ", ParamFracI$`Función venta`, ", fill = NA)"
)
)
)
# Aplicación del desfase de la ventana móvil correspondiente a cada fractal de venta.
# Ejemplo FI1:
# BDPI$FI1_S_MIN_LOW_4_1 <- shift(x = BDPI$MIN_LOW_4_1, n = 1, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFracI$NombreRefVenta,
" <- shift(x = ", "BDPI$", ParamFracI$NombreRefVenta,
", n = ", ParamFracI$Desfase, ", fill = NA)"
)
)
)
# Señal del fractal.
# Ejemplo FI1:
# BDPI$FI1 <- ifelse (BDPI$CLOSE > BDPI$FI1_B_MAX_HIGH_4_1, "BUY", ifelse(BDPI$CLOSE < BDPI$FI1_S_MIN_LOW_4_1, "SELL", NA))
eval(parse(text = paste0("BDPI$", ParamFracI$Fractal,
" <- ifelse(",
ParamFracI$VariableCompra, ParamFracI$`Criterio compra`, "BDPI$", ParamFracI$NombreRefCompra,
", 'BUY', ",
"ifelse(",
ParamFracI$VariableVenta, ParamFracI$`Criterio venta`, "BDPI$", ParamFracI$NombreRefVenta,
", 'SELL', ",
"NA",
")",
")"
)
)
)
View(BDPI)
