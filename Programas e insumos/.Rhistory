hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# 3. CÁLCULO VELA DIARIA ######################################################
BDPD <- BDPI
BDPD$DATE <- as.Date(BDPD$DATEFRAME)
BDPD <- BDPD[,c("DATE","DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
BDPD <- as.data.table(BDPD)
BDPD <- BDPD[,
.(VOLUME = sum(VOLUME),
OPEN = first(OPEN),
HIGH = max(HIGH),
LOW = min(LOW),
CLOSE = last(CLOSE)
),
by = "DATE"
]
# 3. CÁLCULO SEÑALES ##########################################################
# Parametrizacion fractales
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFrac <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
ParamFrac$VentanaMovil <- ParamFrac$`Periodo fin` - ParamFrac$`Periodo inicio` + 1
ParamFrac$Desfase <- -ParamFrac$`Periodo fin`
ParamFrac$NombreRefCompra <- paste0(ParamFrac$`Función compra`,
ParamFrac$`Ref. compra`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$NombreRefVenta <- paste0(ParamFrac$`Función venta`,
ParamFrac$`Ref. venta`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$FractalI <- substr(ParamFrac$Estrategia, 1, 3)
ParamFrac$FractalD <- substr(ParamFrac$Estrategia, 7, 9)
ParamFrac$VariableCompraI <- paste0("BDPI$",ParamFrac$`Variable compra`)
ParamFrac$VariableCompraD <- paste0("BDPD$",ParamFrac$`Variable compra`)
ParamFrac$RefCompraI <- paste0("BDPI$",ParamFrac$`Ref. compra`)
ParamFrac$RefCompraD <- paste0("BDPD$",ParamFrac$`Ref. compra`)
ParamFrac$VariableVentaI <- paste0("BDPI$",ParamFrac$`Variable venta`)
ParamFrac$VariableVentaD <- paste0("BDPD$",ParamFrac$`Variable venta`)
ParamFrac$RefVentaI <- paste0("BDPI$",ParamFrac$`Ref. venta`)
ParamFrac$RefVentaD <- paste0("BDPD$",ParamFrac$`Ref. venta`)
#Función para Cálculo de señales de un fractal
SenalFractal <- function(Fractal,BD,Parametros) {
#PENDIENTE INCLUIR EJEMPLO Y GENERALIZAR
}
FractalIntradiario <- "FI1"
eval(parse(text = y))
#Para FI1 (CLOSE > max(HIGH) entre -4 y -1):
BDPI$MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
BDPI$MAX_HIGH_4_1 <- shift(x = BDPI$MAX_HIGH_4_1, n = 1, fill = NA, type = "lag")
BDPI$MIN_LOW_4_1 <- rollapplyr(data = BDPI$LOW, width = 4, FUN = min, fill = NA)
BDPI$MIN_LOW_4_1 <- shift(x = BDPI$MIN_LOW_4_1, n = 1, fill = NA, type = "lag")
BDPI$FI1 <- ifelse (BDPI$CLOSE > BDPI$MAX_HIGH_4_1,
"BUY",
ifelse(BDPI$CLOSE < BDPI$MIN_LOW_4_1,
"SELL",
NA
)
)
BDPI <- fill(data = BDPI, FI1, .direction = "down")
f <- 1
eval(parse(text = paste0("BDPI$", ParamFrac$NombreRefCompra[f], "[", f, "]"))) <- 1
paste0("BDPI$", ParamFrac$NombreRefCompra[f], "[", f, "]")
eval(parse(text = paste0("BDPI$", ParamFrac$NombreRefCompra[f], "[", f, "]"))) <- 1
eval(parse(text = paste0("BDPI$", ParamFrac$NombreRefCompra[f], "[", f, "]", "<- 1")))
###  Estrategia y estadísticas ETF ECH (Réplica Swell)  ###
###                     2021-03-01                      ###
###                     Version 0.0                     ###
###          Authors: Olga Serna / Ivan Serrano         ###
# 0. DESCRIPCIÓN E INSTRUCCIONES ##############################################
# 0.1 Objetivo
# Calcular la señal de la estrategia y sus estadísticas de retorno y riesgo a
# partir de serie histórica OHLC (apertura, máximo, mínimo y cierre) y un árbol
# de decisión de estrategia.
# 0.2 Supuestos
# 0.2.1 Se realizan operaciones a las que haya lugar después de formación de la
#       vela de mercado para cada franja horaria, teniendo en cuenta el periodo
#       de tiempo permitido de operación definido para cada día, el cual excluye
#       las franjas horarias que se consideran de baja liquidez.
# 0.2.2 Todas las franjas horarias se tienen en cuenta para el cálculo de la
#       señal.
# 0.2.3 Se consigue operar en el mercado a los precios de referencia de los
#       umbrales o precios de entrada definidos en el árbol de decisión, con
#       costos transaccionales asociados a un bid-ask spread nulo.
# 0.2.3 No se considera la dinámica de los flujos de capital, pues  no se
#       tienen en cuenta los faltantes o excedentes de efectivo que se pueden
#       presentar al cerrar y abrir posiciones.
# 0.2.4 Para los cálculos de utilidad (pérdida o ganancia en términos
#       monetarios), se tiene en cuenta si la posición es larga o corta.
# 0.2.4 La hora del archivo de insumo OHLC corresponde a la de Santiago y por
#       lo tanto el código considera las fluctuaciones horarias con relación
#       a la hora del este de Estados Unidos.
# 0.3 Instrucciones
# 0.3.1 Guardar con el nombre "Data ETF ECH.xlsx" el archivo que contiene el
#       histórico de precios OHLC en la misma ruta donde se encuentra ubicado
#       el código "Estrategia y estadísticas ETF ECH (Réplica Swell).R". Se
#       debe verificar que el archivo solo contenga la información mencionada y
#       nada adicional (incluso celdas borradas).
# 1. PAQUETES Y CONFIGURACIONES ###############################################
# Paquetes
Libraries <- c("readxl",      # read_excel
"rstudioapi",  # getActiveDocumentContext
"lubridate",   # makedatetime, year, month,.., second
"ggplot2",     # ggplot
"data.table",  # Data manipulation
"zoo",          # rollapplyr
"tidyr")       # fill
# Instalación/cargue de paquetes
for (L in Libraries) {
eval(parse(text = (paste0("if (!require(",
L,
")) install.packages('",
L,
"')
library(",
L,
")"))))
}
# Ubicación archivos de origen
BaseDirPath = dirname(getActiveDocumentContext()$path)
setwd(BaseDirPath)
#Plantilla gráficos
# 2. LECTURA Y PREPARACIÓN DE DATOS ###########################################
# Lectura de archivo histórico de precios
ArchivoCargue <- "Data ETF ECH.xlsx"
BDPI <- read_excel(ArchivoCargue, sheet = "DATOS ECH")
# Asignación de títulos a las columnas
colnames(BDPI) <- c("DATE","FRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")
# Reorganizacion de fechas y franjas horarias
BDPI$DATEFRAME <- make_datetime(year = year(BDPI$DATE),
month = month(BDPI$DATE),
day = day(BDPI$DATE),
hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# 3. CÁLCULO VELA DIARIA ######################################################
BDPD <- BDPI
BDPD$DATE <- as.Date(BDPD$DATEFRAME)
BDPD <- BDPD[,c("DATE","DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
BDPD <- as.data.table(BDPD)
BDPD <- BDPD[,
.(VOLUME = sum(VOLUME),
OPEN = first(OPEN),
HIGH = max(HIGH),
LOW = min(LOW),
CLOSE = last(CLOSE)
),
by = "DATE"
]
# 3. CÁLCULO SEÑALES ##########################################################
# Parametrizacion fractales
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFrac <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
ParamFrac$VentanaMovil <- ParamFrac$`Periodo fin` - ParamFrac$`Periodo inicio` + 1
ParamFrac$Desfase <- -ParamFrac$`Periodo fin`
ParamFrac$NombreRefCompra <- paste0(ParamFrac$`Función compra`,
ParamFrac$`Ref. compra`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$NombreRefVenta <- paste0(ParamFrac$`Función venta`,
ParamFrac$`Ref. venta`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$FractalI <- substr(ParamFrac$Estrategia, 1, 3)
ParamFrac$FractalD <- substr(ParamFrac$Estrategia, 7, 9)
ParamFrac$VariableCompraI <- paste0("BDPI$",ParamFrac$`Variable compra`)
ParamFrac$VariableCompraD <- paste0("BDPD$",ParamFrac$`Variable compra`)
ParamFrac$RefCompraI <- paste0("BDPI$",ParamFrac$`Ref. compra`)
ParamFrac$RefCompraD <- paste0("BDPD$",ParamFrac$`Ref. compra`)
ParamFrac$VariableVentaI <- paste0("BDPI$",ParamFrac$`Variable venta`)
ParamFrac$VariableVentaD <- paste0("BDPD$",ParamFrac$`Variable venta`)
ParamFrac$RefVentaI <- paste0("BDPI$",ParamFrac$`Ref. venta`)
ParamFrac$RefVentaD <- paste0("BDPD$",ParamFrac$`Ref. venta`)
#Función para Cálculo de señales de un fractal
SenalFractal <- function(Fractal,BD,Parametros) {
#PENDIENTE INCLUIR EJEMPLO Y GENERALIZAR
}
FractalIntradiario <- "FI1"
eval(parse(text = y))
#Para FI1 (CLOSE > max(HIGH) entre -4 y -1):
BDPI$MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
BDPI$MAX_HIGH_4_1 <- shift(x = BDPI$MAX_HIGH_4_1, n = 1, fill = NA, type = "lag")
BDPI$MIN_LOW_4_1 <- rollapplyr(data = BDPI$LOW, width = 4, FUN = min, fill = NA)
BDPI$MIN_LOW_4_1 <- shift(x = BDPI$MIN_LOW_4_1, n = 1, fill = NA, type = "lag")
BDPI$FI1 <- ifelse (BDPI$CLOSE > BDPI$MAX_HIGH_4_1,
"BUY",
ifelse(BDPI$CLOSE < BDPI$MIN_LOW_4_1,
"SELL",
NA
)
)
BDPI <- fill(data = BDPI, FI1, .direction = "down")
f <- 1
View(BDPI)
###  Estrategia y estadísticas ETF ECH (Réplica Swell)  ###
###                     2021-03-01                      ###
###                     Version 0.0                     ###
###          Authors: Olga Serna / Ivan Serrano         ###
# 0. DESCRIPCIÓN E INSTRUCCIONES ##############################################
# 0.1 Objetivo
# Calcular la señal de la estrategia y sus estadísticas de retorno y riesgo a
# partir de serie histórica OHLC (apertura, máximo, mínimo y cierre) y un árbol
# de decisión de estrategia.
# 0.2 Supuestos
# 0.2.1 Se realizan operaciones a las que haya lugar después de formación de la
#       vela de mercado para cada franja horaria, teniendo en cuenta el periodo
#       de tiempo permitido de operación definido para cada día, el cual excluye
#       las franjas horarias que se consideran de baja liquidez.
# 0.2.2 Todas las franjas horarias se tienen en cuenta para el cálculo de la
#       señal.
# 0.2.3 Se consigue operar en el mercado a los precios de referencia de los
#       umbrales o precios de entrada definidos en el árbol de decisión, con
#       costos transaccionales asociados a un bid-ask spread nulo.
# 0.2.3 No se considera la dinámica de los flujos de capital, pues  no se
#       tienen en cuenta los faltantes o excedentes de efectivo que se pueden
#       presentar al cerrar y abrir posiciones.
# 0.2.4 Para los cálculos de utilidad (pérdida o ganancia en términos
#       monetarios), se tiene en cuenta si la posición es larga o corta.
# 0.2.4 La hora del archivo de insumo OHLC corresponde a la de Santiago y por
#       lo tanto el código considera las fluctuaciones horarias con relación
#       a la hora del este de Estados Unidos.
# 0.3 Instrucciones
# 0.3.1 Guardar con el nombre "Data ETF ECH.xlsx" el archivo que contiene el
#       histórico de precios OHLC en la misma ruta donde se encuentra ubicado
#       el código "Estrategia y estadísticas ETF ECH (Réplica Swell).R". Se
#       debe verificar que el archivo solo contenga la información mencionada y
#       nada adicional (incluso celdas borradas).
# 1. PAQUETES Y CONFIGURACIONES ###############################################
# Paquetes
Libraries <- c("readxl",      # read_excel
"rstudioapi",  # getActiveDocumentContext
"lubridate",   # makedatetime, year, month,.., second
"ggplot2",     # ggplot
"data.table",  # Data manipulation
"zoo",          # rollapplyr
"tidyr")       # fill
# Instalación/cargue de paquetes
for (L in Libraries) {
eval(parse(text = (paste0("if (!require(",
L,
")) install.packages('",
L,
"')
library(",
L,
")"))))
}
# Ubicación archivos de origen
BaseDirPath = dirname(getActiveDocumentContext()$path)
setwd(BaseDirPath)
#Plantilla gráficos
# 2. LECTURA Y PREPARACIÓN DE DATOS ###########################################
# Lectura de archivo histórico de precios
ArchivoCargue <- "Data ETF ECH.xlsx"
BDPI <- read_excel(ArchivoCargue, sheet = "DATOS ECH")
# Asignación de títulos a las columnas
colnames(BDPI) <- c("DATE","FRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")
# Reorganizacion de fechas y franjas horarias
BDPI$DATEFRAME <- make_datetime(year = year(BDPI$DATE),
month = month(BDPI$DATE),
day = day(BDPI$DATE),
hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# 3. CÁLCULO VELA DIARIA ######################################################
BDPD <- BDPI
BDPD$DATE <- as.Date(BDPD$DATEFRAME)
BDPD <- BDPD[,c("DATE","DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
BDPD <- as.data.table(BDPD)
BDPD <- BDPD[,
.(VOLUME = sum(VOLUME),
OPEN = first(OPEN),
HIGH = max(HIGH),
LOW = min(LOW),
CLOSE = last(CLOSE)
),
by = "DATE"
]
# 3. CÁLCULO SEÑALES ##########################################################
# Parametrizacion fractales
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFrac <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
ParamFrac$VentanaMovil <- ParamFrac$`Periodo fin` - ParamFrac$`Periodo inicio` + 1
ParamFrac$Desfase <- -ParamFrac$`Periodo fin`
ParamFrac$NombreRefCompra <- paste0(ParamFrac$`Función compra`,
ParamFrac$`Ref. compra`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$NombreRefVenta <- paste0(ParamFrac$`Función venta`,
ParamFrac$`Ref. venta`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$FractalI <- substr(ParamFrac$Estrategia, 1, 3)
ParamFrac$FractalD <- substr(ParamFrac$Estrategia, 7, 9)
ParamFrac$VariableCompraI <- paste0("BDPI$",ParamFrac$`Variable compra`)
ParamFrac$VariableCompraD <- paste0("BDPD$",ParamFrac$`Variable compra`)
ParamFrac$RefCompraI <- paste0("BDPI$",ParamFrac$`Ref. compra`)
ParamFrac$RefCompraD <- paste0("BDPD$",ParamFrac$`Ref. compra`)
ParamFrac$VariableVentaI <- paste0("BDPI$",ParamFrac$`Variable venta`)
ParamFrac$VariableVentaD <- paste0("BDPD$",ParamFrac$`Variable venta`)
ParamFrac$RefVentaI <- paste0("BDPI$",ParamFrac$`Ref. venta`)
ParamFrac$RefVentaD <- paste0("BDPD$",ParamFrac$`Ref. venta`)
View(BDPI)
eval(parse(text = paste0("BDPI$", ParamFrac$NombreRefCompra[f], "[", f, "]", "<- 1")))
View(BDPI)
ParamFrac$VentanaMovil[f]
ParamFrac$RefCompraI[f]
ParamFrac$`Variable compra`[f]
ParamFrac$`Función compra`[f]
paste0("BDPI$", ParamFrac$NombreRefCompra[f], "[", f, "]",
"<- rollapplyr(data = ", ParamFrac$RefCompraI[f],
", width = ", ParamFrac$VentanaMovil[f],
", FUN = ", ParamFrac$`Función compra`[f], "fill = NA)"
)
paste0("BDPI$", ParamFrac$NombreRefCompra[f], "[", f, "]",
" <- rollapplyr(data = ", ParamFrac$RefCompraI[f],
", width = ", ParamFrac$VentanaMovil[f],
", FUN = ", ParamFrac$`Función compra`[f], ", fill = NA)"
)
View(ParamFrac)
View(BDPI)
BDPI$MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
BDPI$MAX_HIGH_4_1 <- shift(x = BDPI$MAX_HIGH_4_1, n = 1, fill = NA)
# Cálculo de la funcion sobre la referencia para el fractal de compra, por ejemplo:
# BDPI$MAX_HIGH_4_1 <- rollapplyr(data = BDPI$HIGH, width = 4, FUN = max, fill = NA)
eval(parse(text = paste0("BDPI$", ParamFrac$NombreRefCompra[f],
" <- rollapplyr(data = ", ParamFrac$RefCompraI[f],
", width = ", ParamFrac$VentanaMovil[f],
", FUN = ", ParamFrac$`Función compra`[f], ", fill = NA)"
)
)
)
paste0("BDPI$", ParamFrac$NombreRefCompra[f],
" <- rollapplyr(data = ", ParamFrac$RefCompraI[f],
", width = ", ParamFrac$VentanaMovil[f],
", FUN = ", ParamFrac$`Función compra`[f], ", fill = NA)"
)
###  Estrategia y estadísticas ETF ECH (Réplica Swell)  ###
###                     2021-03-01                      ###
###                     Version 0.0                     ###
###          Authors: Olga Serna / Ivan Serrano         ###
# 0. DESCRIPCIÓN E INSTRUCCIONES ##############################################
# 0.1 Objetivo
# Calcular la señal de la estrategia y sus estadísticas de retorno y riesgo a
# partir de serie histórica OHLC (apertura, máximo, mínimo y cierre) y un árbol
# de decisión de estrategia.
# 0.2 Supuestos
# 0.2.1 Se realizan operaciones a las que haya lugar después de formación de la
#       vela de mercado para cada franja horaria, teniendo en cuenta el periodo
#       de tiempo permitido de operación definido para cada día, el cual excluye
#       las franjas horarias que se consideran de baja liquidez.
# 0.2.2 Todas las franjas horarias se tienen en cuenta para el cálculo de la
#       señal.
# 0.2.3 Se consigue operar en el mercado a los precios de referencia de los
#       umbrales o precios de entrada definidos en el árbol de decisión, con
#       costos transaccionales asociados a un bid-ask spread nulo.
# 0.2.3 No se considera la dinámica de los flujos de capital, pues  no se
#       tienen en cuenta los faltantes o excedentes de efectivo que se pueden
#       presentar al cerrar y abrir posiciones.
# 0.2.4 Para los cálculos de utilidad (pérdida o ganancia en términos
#       monetarios), se tiene en cuenta si la posición es larga o corta.
# 0.2.4 La hora del archivo de insumo OHLC corresponde a la de Santiago y por
#       lo tanto el código considera las fluctuaciones horarias con relación
#       a la hora del este de Estados Unidos.
# 0.3 Instrucciones
# 0.3.1 Guardar con el nombre "Data ETF ECH.xlsx" el archivo que contiene el
#       histórico de precios OHLC en la misma ruta donde se encuentra ubicado
#       el código "Estrategia y estadísticas ETF ECH (Réplica Swell).R". Se
#       debe verificar que el archivo solo contenga la información mencionada y
#       nada adicional (incluso celdas borradas).
# 1. PAQUETES Y CONFIGURACIONES ###############################################
# Paquetes
Libraries <- c("readxl",      # read_excel
"rstudioapi",  # getActiveDocumentContext
"lubridate",   # makedatetime, year, month,.., second
"ggplot2",     # ggplot
"data.table",  # Data manipulation
"zoo",          # rollapplyr
"tidyr")       # fill
# Instalación/cargue de paquetes
for (L in Libraries) {
eval(parse(text = (paste0("if (!require(",
L,
")) install.packages('",
L,
"')
library(",
L,
")"))))
}
# Ubicación archivos de origen
BaseDirPath = dirname(getActiveDocumentContext()$path)
setwd(BaseDirPath)
#Plantilla gráficos
# 2. LECTURA Y PREPARACIÓN DE DATOS ###########################################
# Lectura de archivo histórico de precios
ArchivoCargue <- "Data ETF ECH.xlsx"
BDPI <- read_excel(ArchivoCargue, sheet = "DATOS ECH")
# Asignación de títulos a las columnas
colnames(BDPI) <- c("DATE","FRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")
# Reorganizacion de fechas y franjas horarias
BDPI$DATEFRAME <- make_datetime(year = year(BDPI$DATE),
month = month(BDPI$DATE),
day = day(BDPI$DATE),
hour = hour(BDPI$FRAME),
min = minute(BDPI$FRAME),
sec = second(BDPI$FRAME))
BDPI[,c("DATE","FRAME")] <- NULL
BDPI <- BDPI[,c("DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
# Tamaño y ordenamiento de datos
N <- length(BDPI$DATEFRAME)
BDPI <- BDPI[order(BDPI$DATEFRAME),]
# 3. CÁLCULO VELA DIARIA ######################################################
BDPD <- BDPI
BDPD$DATE <- as.Date(BDPD$DATEFRAME)
BDPD <- BDPD[,c("DATE","DATEFRAME","VOLUME","OPEN","HIGH","LOW","CLOSE")]
BDPD <- as.data.table(BDPD)
BDPD <- BDPD[,
.(VOLUME = sum(VOLUME),
OPEN = first(OPEN),
HIGH = max(HIGH),
LOW = min(LOW),
CLOSE = last(CLOSE)
),
by = "DATE"
]
# 3. CÁLCULO SEÑALES ##########################################################
# Parametrizacion fractales
ArchivoFractales <- "Parametros fractales.xlsx"
ParamFrac <- read_excel(ArchivoFractales, sheet = "Parametros fractales")
ParamFrac$VentanaMovil <- ParamFrac$`Periodo fin` - ParamFrac$`Periodo inicio` + 1
ParamFrac$Desfase <- -ParamFrac$`Periodo fin`
ParamFrac$NombreRefCompra <- paste0(ParamFrac$`Función compra`,
ParamFrac$`Ref. compra`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$NombreRefVenta <- paste0(ParamFrac$`Función venta`,
ParamFrac$`Ref. venta`,
"_",
-ParamFrac$`Periodo inicio`,
"_",
-ParamFrac$`Periodo fin`)
ParamFrac$FractalI <- substr(ParamFrac$Estrategia, 1, 3)
ParamFrac$FractalD <- substr(ParamFrac$Estrategia, 7, 9)
ParamFrac$VariableCompraI <- paste0("BDPI$",ParamFrac$`Variable compra`)
ParamFrac$VariableCompraD <- paste0("BDPD$",ParamFrac$`Variable compra`)
ParamFrac$RefCompraI <- paste0("BDPI$",ParamFrac$`Ref. compra`)
ParamFrac$RefCompraD <- paste0("BDPD$",ParamFrac$`Ref. compra`)
ParamFrac$VariableVentaI <- paste0("BDPI$",ParamFrac$`Variable venta`)
ParamFrac$VariableVentaD <- paste0("BDPD$",ParamFrac$`Variable venta`)
ParamFrac$RefVentaI <- paste0("BDPI$",ParamFrac$`Ref. venta`)
ParamFrac$RefVentaD <- paste0("BDPD$",ParamFrac$`Ref. venta`)
paste0("BDPI$", ParamFrac$NombreRefVenta[f],
" <- rollapplyr(data = ", ParamFrac$RefVentaI[f],
", width = ", ParamFrac$VentanaMovil[f],
", FUN = ", ParamFrac$`Función venta`[f], ", fill = NA)"
)
paste0("BDPI$", ParamFrac$NombreRefVenta[f],
" <- shift(x = ", "BDPI$", ParamFrac$NombreRefVenta[f], "[", f, "]",
", n = ", ParamFrac$Desfase[f], ", fill = NA)"
)
paste0("BDPI$", ParamFrac$NombreRefCompra,
" <- shift(x = ", "BDPI$", ParamFrac$NombreRefCompra[f],
", n = ", ParamFrac$Desfase[f], ", fill = NA)"
)
paste0("BDPI$", ParamFrac$NombreRefCompra[f],
" <- shift(x = ", "BDPI$", ParamFrac$NombreRefCompra[f],
", n = ", ParamFrac$Desfase[f], ", fill = NA)"
)
paste0("BDPI$", ParamFrac$NombreRefVenta,
" <- shift(x = ", "BDPI$", ParamFrac$NombreRefVenta[f], "[", f, "]",
", n = ", ParamFrac$Desfase[f], ", fill = NA)"
)
paste0("BDPI$", ParamFrac$NombreRefVenta[f],
" <- shift(x = ", "BDPI$", ParamFrac$NombreRefVenta[f], "[", f, "]",
", n = ", ParamFrac$Desfase[f], ", fill = NA)"
)
ParamFrac$NombreRefVenta[f]
ParamFrac$NombreRefVenta[f]
paste0("BDPI$", ParamFrac$NombreRefVenta[f],
" <- shift(x = ", "BDPI$", ParamFrac$NombreRefVenta[f],
", n = ", ParamFrac$Desfase[f], ", fill = NA)"
)
